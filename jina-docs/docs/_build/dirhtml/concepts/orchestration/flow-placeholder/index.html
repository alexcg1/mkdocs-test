<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

<meta property="og:title" content="Flow" />
  
<meta property="og:type" content="website" />
  
<meta property="og:url" content="https://docs.jina.ai/concepts/orchestration/flow-placeholder/" />
  
<meta property="og:site_name" content="Jina 3.14.2 Documentation" />
  
<meta property="og:description" content="A Flow orchestrates Executor s into a processing pipeline to accomplish a task. Documents “flow” through the pipeline and are processed by Executors. You can think of Flow as an interface to configure and launch your microservice architecture, while the heavy lifting is done by the services thems..." />
  
<meta property="og:image" content="https://docs.jina.ai/_static/banner.png" />
  
<meta property="og:image:alt" content="Jina 3.14.2 Documentation" />
  
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@JinaAI_">
<meta name="twitter:creator" content="@JinaAI_">
<meta name="description" content="Build multimodal AI services via cloud native technologies · Neural Search · Generative AI · Cloud Native · MLOps">
<meta property="og:description" content="Build multimodal AI services via cloud native technologies · Neural Search · Generative AI · Cloud Native · MLOps">

    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-48ZDWC8GT6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-48ZDWC8GT6');
</script>

<script async defer src="https://buttons.github.io/buttons.js"></script>
    <link rel="index" title="Index" href="../../../genindex/" /><link rel="search" title="Search" href="../../../search/" /><link rel="next" title="Add Executors" href="../add-executors/" /><link rel="prev" title="Deployment" href="../deployment/" />
        <link rel="canonical" href="https://docs.jina.ai/concepts/orchestration/flow-placeholder.html" />

    <link rel="shortcut icon" href="../../../_static/favicon.ico"/><meta name="generator" content="sphinx-5.2.3, furo 2022.09.29"/>
        <title>Flow - Jina 3.14.2 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo.css?digest=d81277517bee4d6b0349d71bb2661d4890b5617c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/main.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/docbot.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" />
    
    


<style>
  body {
    --color-code-background: #ffffff;
  --color-code-foreground: #4d4d4d;
  --color-brand-primary: #009191;
  --color-brand-content: #009191;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #FBCB67;
  --color-brand-content: #FBCB67;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-brand-primary: #FBCB67;
  --color-brand-content: #FBCB67;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
    <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
    <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
    <header class="mobile-header">
        <div class="header-left">
            <label class="nav-overlay-icon" for="__navigation">
                <div class="visually-hidden">Toggle site navigation sidebar</div>
                <i class="icon">
                    <svg>
                        <use href="#svg-menu"></use>
                    </svg>
                </i>
            </label>
        </div>
        <div class="header-center">
            <a href="../../../">
                <div class="brand">Jina 3.14.2 documentation</div>
            </a>
        </div>
        <div class="header-right">
            <div class="theme-toggle-container theme-toggle-header">
                <button class="theme-toggle">
                    <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
                    <svg class="theme-icon-when-auto">
                        <use href="#svg-sun-half"></use>
                    </svg>
                    <svg class="theme-icon-when-dark">
                        <use href="#svg-moon"></use>
                    </svg>
                    <svg class="theme-icon-when-light">
                        <use href="#svg-sun"></use>
                    </svg>
                </button>
            </div>
            <label class="toc-overlay-icon toc-header-icon" for="__toc">
                <div class="visually-hidden">Toggle table of contents sidebar</div>
                <i class="icon">
                    <svg>
                        <use href="#svg-toc"></use>
                    </svg>
                </i>
            </label>
        </div>
    </header>
    <aside class="sidebar-drawer">
        <div class="sidebar-container">
            
            <div class="sidebar-sticky"><a class="sidebar-brand" href="../../../">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../../../_static/logo-light.svg" alt="Light Logo" />
    <img class="sidebar-logo only-dark" src="../../../_static/logo-dark.svg" alt="Dark Logo" />
  </div>
  
  
</a>
<script>
  function setPrefix(prefix){
    window.location.href = prefix
  }
</script>
<script defer>
  fetch(`https://${window.location.host}/_versions.json`)
  .then((resp) => resp.json())
  .then((data) => {
    var versionSelector = document.getElementsByClassName("version-select")[0];
    var currentPrefix = window.location.href.toString().split(window.location.host)[1].split('/')[1];

    for(var i = 0; i < data.length; i++){
      var option = document.createElement("option");
      option.innerHTML = data[i].version;
      option.value = "/" + data[i].version;
      versionSelector.appendChild(option);
      if(currentPrefix === data[i].version){
        versionSelector.selectedIndex = i + 1;
      }
    }
  })
  .catch((err) => console.log(err));
</script>
<div class="sd-d-flex-row sd-align-major-spaced">
  <a class="github-button" href="https://github.com/jina-ai/jina" data-icon="octicon-star" data-show-count="true" aria-label="Star jina-ai/jina on GitHub" style="opacity: 0;">Star</a>
  <select onChange="setPrefix(this.value)" class="version-select">
    <option value="/">latest</option>
  </select>
</div><form class="sidebar-search-container" method="get" action="../../../search/" role="search">
  <input class="sidebar-search" placeholder=Search name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
    <p class="caption" role="heading"><span class="caption-text">Get Started</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../get-started/install/"><svg aria-hidden="true" class="sd-octicon sd-octicon-desktop-download" height="1.0em" version="1.1" viewbox="0 0 16 16" width="1.0em"><path d="M4.927 5.427l2.896 2.896a.25.25 0 00.354 0l2.896-2.896A.25.25 0 0010.896 5H8.75V.75a.75.75 0 10-1.5 0V5H5.104a.25.25 0 00-.177.427z"></path><path d="M1.573 2.573a.25.25 0 00-.073.177v7.5a.25.25 0 00.25.25h12.5a.25.25 0 00.25-.25v-7.5a.25.25 0 00-.25-.25h-3a.75.75 0 110-1.5h3A1.75 1.75 0 0116 2.75v7.5A1.75 1.75 0 0114.25 12h-3.727c.099 1.041.52 1.872 1.292 2.757A.75.75 0 0111.25 16h-6.5a.75.75 0 01-.565-1.243c.772-.885 1.192-1.716 1.292-2.757H1.75A1.75 1.75 0 010 10.25v-7.5A1.75 1.75 0 011.75 1h3a.75.75 0 010 1.5h-3a.25.25 0 00-.177.073zM6.982 12a5.72 5.72 0 01-.765 2.5h3.566a5.72 5.72 0 01-.765-2.5H6.982z"></path></svg> Install</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../get-started/install/docker/">Via Docker Image</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../get-started/install/apple-silicon-m1-m2/">On Apple Silicon</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../get-started/install/windows/">On Windows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../get-started/install/troubleshooting/">Troubleshooting</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../get-started/create-app/"><span class="fas fa-folder-plus"></span> Create First Project</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../preliminaries/"><span class="fas fa-egg"></span> Preliminaries</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../preliminaries/coding-in-python-yaml/">Coding in Python/YAML</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Concepts</span></p>
<ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../executor/"><span class="fas fa-gears"></span> Executor</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../executor/create/">Create</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../executor/add-endpoints/">Add Endpoints</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../executor/serve/">Serve</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../executor/dynamic-batching/">Dynamic Batching</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../executor/health-check/">Health Check</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../executor/hot-reload/">Hot Reload</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../executor/file-structure/">File Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../executor/containerize/">Containerize</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../executor/instrumentation/">Instrumentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../executor/docarray-v2/">(Beta) DocArray v2</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../executor/yaml-spec/"><svg aria-hidden="true" class="sd-octicon sd-octicon-file-code" height="1.0em" version="1.1" viewbox="0 0 16 16" width="1.0em"><path d="M4 1.75C4 .784 4.784 0 5.75 0h5.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v8.586A1.75 1.75 0 0114.25 15h-9a.75.75 0 010-1.5h9a.25.25 0 00.25-.25V6h-2.75A1.75 1.75 0 0110 4.25V1.5H5.75a.25.25 0 00-.25.25v2.5a.75.75 0 01-1.5 0v-2.5zm7.5-.188V4.25c0 .138.112.25.25.25h2.688a.252.252 0 00-.011-.013l-2.914-2.914a.272.272 0 00-.013-.011zM5.72 6.72a.75.75 0 000 1.06l1.47 1.47-1.47 1.47a.75.75 0 101.06 1.06l2-2a.75.75 0 000-1.06l-2-2a.75.75 0 00-1.06 0zM3.28 7.78a.75.75 0 00-1.06-1.06l-2 2a.75.75 0 000 1.06l2 2a.75.75 0 001.06-1.06L1.81 9.25l1.47-1.47z" fill-rule="evenodd"></path></svg> YAML specification</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../"><span class="fas fa-network-wired"></span> Orchestration</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../deployment/">Deployment</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Flow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../add-executors/">Add Executors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../scale-out/">Scale Out</a></li>
<li class="toctree-l2"><a class="reference internal" href="../hot-reload/">Hot Reload</a></li>
<li class="toctree-l2"><a class="reference internal" href="../handle-exceptions/">Handle Exceptions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../readiness/">Readiness</a></li>
<li class="toctree-l2"><a class="reference internal" href="../health-check/">Health Check</a></li>
<li class="toctree-l2"><a class="reference internal" href="../instrumentation/">Instrumentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting-on-multiprocess/">Troubleshooting on Multiprocessing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../yaml-spec/"><svg aria-hidden="true" class="sd-octicon sd-octicon-file-code" height="1.0em" version="1.1" viewbox="0 0 16 16" width="1.0em"><path d="M4 1.75C4 .784 4.784 0 5.75 0h5.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v8.586A1.75 1.75 0 0114.25 15h-9a.75.75 0 010-1.5h9a.25.25 0 00.25-.25V6h-2.75A1.75 1.75 0 0110 4.25V1.5H5.75a.25.25 0 00-.25.25v2.5a.75.75 0 01-1.5 0v-2.5zm7.5-.188V4.25c0 .138.112.25.25.25h2.688a.252.252 0 00-.011-.013l-2.914-2.914a.272.272 0 00-.013-.011zM5.72 6.72a.75.75 0 000 1.06l1.47 1.47-1.47 1.47a.75.75 0 101.06 1.06l2-2a.75.75 0 000-1.06l-2-2a.75.75 0 00-1.06 0zM3.28 7.78a.75.75 0 00-1.06-1.06l-2 2a.75.75 0 000 1.06l2 2a.75.75 0 001.06-1.06L1.81 9.25l1.47-1.47z" fill-rule="evenodd"></path></svg> YAML specification</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../gateway/"><span class="fas fa-door-open"></span> Gateway</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../gateway/health-check/">Health Check</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../gateway/rate-limit/">Rate Limit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../gateway/customize-http-endpoints/">Customize HTTP endpoints</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../gateway/customization/">Customization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../gateway/yaml-spec/"><svg aria-hidden="true" class="sd-octicon sd-octicon-file-code" height="1.0em" version="1.1" viewbox="0 0 16 16" width="1.0em"><path d="M4 1.75C4 .784 4.784 0 5.75 0h5.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v8.586A1.75 1.75 0 0114.25 15h-9a.75.75 0 010-1.5h9a.25.25 0 00.25-.25V6h-2.75A1.75 1.75 0 0110 4.25V1.5H5.75a.25.25 0 00-.25.25v2.5a.75.75 0 01-1.5 0v-2.5zm7.5-.188V4.25c0 .138.112.25.25.25h2.688a.252.252 0 00-.011-.013l-2.914-2.914a.272.272 0 00-.013-.011zM5.72 6.72a.75.75 0 000 1.06l1.47 1.47-1.47 1.47a.75.75 0 101.06 1.06l2-2a.75.75 0 000-1.06l-2-2a.75.75 0 00-1.06 0zM3.28 7.78a.75.75 0 00-1.06-1.06l-2 2a.75.75 0 000 1.06l2 2a.75.75 0 001.06-1.06L1.81 9.25l1.47-1.47z" fill-rule="evenodd"></path></svg> YAML specification</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../client/"><span class="fas fa-laptop-code"></span> Client</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../client/send-receive-data/">Send &amp; Receive Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../client/send-parameters/">Send Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../client/send-graphql-mutation/">Send GraphQL Mutation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../client/callbacks/">Callbacks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../client/rate-limit/">Rate Limit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../client/instrumentation/">Instrumentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../client/third-party-clients/">Third-party clients</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Cloud Native</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../cloud-nativeness/k8s/"><span class="fas fa-dharmachakra"></span> Kubernetes Support</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../cloud-nativeness/kubernetes/">Deploy on Kubernetes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../cloud-nativeness/docker-compose/"><span class="fab fa-docker"></span> Docker Compose Support</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../cloud-nativeness/opentelemetry/"><svg aria-hidden="true" class="sd-octicon sd-octicon-telescope-fill" height="1.0em" version="1.1" viewbox="0 0 16 16" width="1.0em"><path d="M8.531 10.21a.75.75 0 01.944.253l2.644 3.864a.75.75 0 11-1.238.847L9 12.424v2.826a.75.75 0 01-1.5 0v-2.826l-1.881 2.75a.75.75 0 01-1.238-.848l2.048-2.992a.75.75 0 01.293-.252l1.81-.871zM11.905.42a1.5 1.5 0 012.144.49l1.692 2.93a1.5 1.5 0 01-.649 2.102L2.895 11.815a1.5 1.5 0 01-1.95-.602l-.68-1.176a1.5 1.5 0 01.455-1.99L11.905.422zM3.279 8.119l.835 1.445 1.355-.653-.947-1.64-1.243.848zm7.728-1.874L9.6 3.808l1.243-.848 1.52 2.631-1.356.653z" fill-rule="evenodd"></path></svg> OpenTelemetry Support</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../cloud-nativeness/opentelemetry-migration/">Migrate from Prometheus/Grafana to OpenTelemetry</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cloud-nativeness/monitoring/">Prometheus/Grafana Support (Legacy)</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../../jina-ai-cloud/"><svg aria-hidden="true" class="sd-octicon sd-octicon-beaker" height="1.0em" version="1.1" viewbox="0 0 16 16" width="1.0em"><path d="M5 5.782V2.5h-.25a.75.75 0 010-1.5h6.5a.75.75 0 010 1.5H11v3.282l3.666 5.76C15.619 13.04 14.543 15 12.767 15H3.233c-1.776 0-2.852-1.96-1.899-3.458L5 5.782zM9.5 2.5h-3V6a.75.75 0 01-.117.403L4.73 9h6.54L9.617 6.403A.75.75 0 019.5 6V2.5zm-6.9 9.847L3.775 10.5h8.45l1.175 1.847a.75.75 0 01-.633 1.153H3.233a.75.75 0 01-.633-1.153z" fill-rule="evenodd"></path></svg> Jina AI Cloud</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../jina-ai-cloud/login/">Login &amp; Token Management</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../executor/hub/">Executor Hub</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../executor/hub/hub-portal/">Portal</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../executor/hub/create-hub-executor/">Create</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../executor/hub/push-executor/">Publish</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../executor/hub/use-hub-executor/">Use</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../executor/hub/sandbox/">Sandbox</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../executor/hub/debug-executor/">Debug</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../jcloud/">Jina AI Cloud Hosting</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle child pages in navigation</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../jcloud/yaml-spec/"><svg aria-hidden="true" class="sd-octicon sd-octicon-file-code" height="1.0em" version="1.1" viewbox="0 0 16 16" width="1.0em"><path d="M4 1.75C4 .784 4.784 0 5.75 0h5.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v8.586A1.75 1.75 0 0114.25 15h-9a.75.75 0 010-1.5h9a.25.25 0 00.25-.25V6h-2.75A1.75 1.75 0 0110 4.25V1.5H5.75a.25.25 0 00-.25.25v2.5a.75.75 0 01-1.5 0v-2.5zm7.5-.188V4.25c0 .138.112.25.25.25h2.688a.252.252 0 00-.011-.013l-2.914-2.914a.272.272 0 00-.013-.011zM5.72 6.72a.75.75 0 000 1.06l1.47 1.47-1.47 1.47a.75.75 0 101.06 1.06l2-2a.75.75 0 000-1.06l-2-2a.75.75 0 00-1.06 0zM3.28 7.78a.75.75 0 00-1.06-1.06l-2 2a.75.75 0 000 1.06l2 2a.75.75 0 001.06-1.06L1.81 9.25l1.47-1.47z" fill-rule="evenodd"></path></svg> YAML specification</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api-rst/"><span class="fab fa-python"></span> Python API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cli/"><svg aria-hidden="true" class="sd-octicon sd-octicon-terminal" height="1.0em" version="1.1" viewbox="0 0 16 16" width="1.0em"><path d="M0 2.75C0 1.784.784 1 1.75 1h12.5c.966 0 1.75.784 1.75 1.75v10.5A1.75 1.75 0 0114.25 15H1.75A1.75 1.75 0 010 13.25V2.75zm1.75-.25a.25.25 0 00-.25.25v10.5c0 .138.112.25.25.25h12.5a.25.25 0 00.25-.25V2.75a.25.25 0 00-.25-.25H1.75zM7.25 8a.75.75 0 01-.22.53l-2.25 2.25a.75.75 0 11-1.06-1.06L5.44 8 3.72 6.28a.75.75 0 111.06-1.06l2.25 2.25c.141.14.22.331.22.53zm1.5 1.5a.75.75 0 000 1.5h3a.75.75 0 000-1.5h-3z" fill-rule="evenodd"></path></svg> Command-Line Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../yaml-spec/"><svg aria-hidden="true" class="sd-octicon sd-octicon-file-code" height="1.0em" version="1.1" viewbox="0 0 16 16" width="1.0em"><path d="M4 1.75C4 .784 4.784 0 5.75 0h5.586c.464 0 .909.184 1.237.513l2.914 2.914c.329.328.513.773.513 1.237v8.586A1.75 1.75 0 0114.25 15h-9a.75.75 0 010-1.5h9a.25.25 0 00.25-.25V6h-2.75A1.75 1.75 0 0110 4.25V1.5H5.75a.25.25 0 00-.25.25v2.5a.75.75 0 01-1.5 0v-2.5zm7.5-.188V4.25c0 .138.112.25.25.25h2.688a.252.252 0 00-.011-.013l-2.914-2.914a.272.272 0 00-.013-.011zM5.72 6.72a.75.75 0 000 1.06l1.47 1.47-1.47 1.47a.75.75 0 101.06 1.06l2-2a.75.75 0 000-1.06l-2-2a.75.75 0 00-1.06 0zM3.28 7.78a.75.75 0 00-1.06-1.06l-2 2a.75.75 0 000 1.06l2 2a.75.75 0 001.06-1.06L1.81 9.25l1.47-1.47z" fill-rule="evenodd"></path></svg> YAML Specification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../envs/"><svg aria-hidden="true" class="sd-octicon sd-octicon-list-unordered" height="1.0em" version="1.1" viewbox="0 0 16 16" width="1.0em"><path d="M2 4a1 1 0 100-2 1 1 0 000 2zm3.75-1.5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zm0 5a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5zM3 8a1 1 0 11-2 0 1 1 0 012 0zm-1 6a1 1 0 100-2 1 1 0 000 2z" fill-rule="evenodd"></path></svg> Environment Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../telemetry/"><span class="fas fa-tower-cell"></span> Telemetry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../proto/docs/">Protocol Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer-reference/clean-code/"><span class="fas fa-broom"></span> Clean &amp; Efficient Code</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Legacy Support</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../get-started/migrate/">Migrate Jina 2 to Jina 3</a></li>
<li class="toctree-l1"><a class="reference external" href="https://docs2.jina.ai/">Jina 2 Documentation</a></li>
</ul>

    <p class="caption" role="heading"><span class="caption-text">Ecosystem</span></p>
    <ul>
        <li class="toctree-l1">
            <a class="reference internal" href="#">
                <img class="sidebar-ecosys-logo only-light-line" src="../../../_static/search-light.svg">
                <img class="sidebar-ecosys-logo only-dark-line" src="../../../_static/search-dark.svg">
                Jina</a></li>
        <li class="toctree-l1"><a class="reference external" href="https://cloud.jina.ai">
            <img class="sidebar-ecosys-logo only-light-line" src="../../../_static/hub-light.svg">
            <img class="sidebar-ecosys-logo only-dark-line" src="../../../_static/hub-dark.svg">
            Jina Hub</a></li>
        <li class="toctree-l1"><a class="reference external" href="https://finetuner.jina.ai">
            <img class="sidebar-ecosys-logo only-light-line" src="../../../_static/finetuner-light.svg">
            <img class="sidebar-ecosys-logo only-dark-line" src="../../../_static/finetuner-dark.svg">
            Finetuner</a></li>
        <li class="toctree-l1"><a class="reference external" href="https://docarray.jina.ai">
            <img class="sidebar-ecosys-logo only-light-line" src="../../../_static/docarray-light.svg">
            <img class="sidebar-ecosys-logo only-dark-line" src="../../../_static/docarray-dark.svg">
            DocArray</a></li>
        <li class="toctree-l1"><a class="reference external" href="https://clip-as-service.jina.ai">
            <img class="sidebar-ecosys-logo only-light-line" src="../../../_static/cas-light.svg">
            <img class="sidebar-ecosys-logo only-dark-line" src="../../../_static/cas-dark.svg">
            CLIP-as-service</a></li>
        <li class="toctree-l1"><a class="reference external" href="https://github.com/jina-ai/jcloud">
            <img class="sidebar-ecosys-logo only-light-line" src="../../../_static/JCloud-light.svg">
            <img class="sidebar-ecosys-logo only-dark-line" src="../../../_static/JCloud-dark.svg">
            JCloud</a></li>
        <li class="toctree-l1"><a class="reference external" href="https://now.jina.ai">
            <img class="sidebar-ecosys-logo only-light-line" src="../../../_static/now-light.svg">
            <img class="sidebar-ecosys-logo only-dark-line" src="../../../_static/now-dark.svg">
            NOW</a></li>
    </ul>
</div>

</div>

            </div>
            
        </div>
    </aside>
    <div class="main">
        <div class="content">
            <div class="article-container">
                <a href="#" class="back-to-top muted-link">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
                    </svg>
                    <span>Back to top</span>
                </a>
                <div class="content-icon-container"><div class="theme-toggle-container theme-toggle-content">
                        <button class="theme-toggle">
                            <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
                            <svg class="theme-icon-when-auto">
                                <use href="#svg-sun-half"></use>
                            </svg>
                            <svg class="theme-icon-when-dark">
                                <use href="#svg-moon"></use>
                            </svg>
                            <svg class="theme-icon-when-light">
                                <use href="#svg-sun"></use>
                            </svg>
                        </button>
                    </div>
                    <label class="toc-overlay-icon toc-content-icon"
                           for="__toc">
                        <div class="visually-hidden">Toggle table of contents sidebar</div>
                        <i class="icon">
                            <svg>
                                <use href="#svg-toc"></use>
                            </svg>
                        </i>
                    </label>
                </div>
                <article role="main">
                    <section id="flow">
<span id="flow-cookbook"></span><h1>Flow<a class="headerlink" href="#flow" title="Permalink to this heading">#</a></h1>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>A Flow is a kind of <code class="xref py py-class docutils literal notranslate"><span class="pre">Orchestration</span></code>. Be sure to read up on that too!</p>
</div>
<p>A <code class="xref py py-class docutils literal notranslate"><span class="pre">Flow</span></code> orchestrates <code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code>s into a processing pipeline to accomplish a task. Documents “flow” through the pipeline and are processed by Executors.</p>
<p>You can think of Flow as an interface to configure and launch your <a class="reference internal" href="../../preliminaries/#architecture-overview"><span class="std std-ref">microservice architecture</span></a>, while the heavy lifting is done by the <a class="reference internal" href="../../executor/#executor-cookbook"><span class="std std-ref">services</span></a> themselves. In particular, each Flow also launches a <a class="reference internal" href="../../gateway/#gateway"><span class="std std-ref">Gateway</span></a> service, which can expose all other services through an API that you define.</p>
<section id="why-use-a-flow">
<h2>Why use a Flow?<a class="headerlink" href="#why-use-a-flow" title="Permalink to this heading">#</a></h2>
<p>Once you’ve learned DocumentArray and Executor, you can split a big task into small independent modules and services.
But you need to chain them together to bring real value and build and serve an application. Flows enable you to do exactly this.</p>
<ul class="simple">
<li><p>Flows connect microservices (Executors) to build a service with proper client/server style interface over HTTP, gRPC, or WebSockets.</p></li>
<li><p>Flows let you scale these Executors independently to match your requirements.</p></li>
<li><p>Flows let you easily use other cloud-native orchestrators, such as Kubernetes, to manage your service.</p></li>
</ul>
</section>
<section id="create">
<span id="create-flow"></span><h2>Create<a class="headerlink" href="#create" title="Permalink to this heading">#</a></h2>
<p>The most trivial <code class="xref py py-class docutils literal notranslate"><span class="pre">Flow</span></code> is an empty one. It can be defined in Python or from a YAML file:</p>
<div class="tab-set docutils">
<input checked="True" class="tab-input" id="tab-set--0-input--1" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--1">Python</label><div class="tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jina</span> <span class="kn">import</span> <span class="n">Flow</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">Flow</span><span class="p">()</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--0-input--2" name="tab-set--0" type="radio"><label class="tab-label" for="tab-set--0-input--2">YAML</label><div class="tab-content docutils">
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">jtype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Flow</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>All arguments received by <code class="xref py py-class docutils literal notranslate"><span class="pre">Flow()</span></code> API will be propagated to other entities (Gateway, Executor) with the following exceptions:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">uses</span></code> and <code class="docutils literal notranslate"><span class="pre">uses_with</span></code> won’t be passed to Gateway</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">port</span></code>, <code class="docutils literal notranslate"><span class="pre">port_monitoring</span></code>, <code class="docutils literal notranslate"><span class="pre">uses</span></code> and <code class="docutils literal notranslate"><span class="pre">uses_with</span></code> won’t be passed to Executor</p></li>
</ul>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>An empty Flow contains only <a class="reference internal" href="../../gateway/#gateway"><span class="std std-ref">the Gateway</span></a>.</p>
</div>
<figure class="align-default">
<a class="reference internal image-reference" href="../../../_images/zero-flow.svg"><img alt="../../../_images/zero-flow.svg" src="../../../_images/zero-flow.svg" /></a>
</figure>
<p>For production, you should define your Flows with YAML. This is because YAML files are independent of the Python logic code and easier to maintain.</p>
</section>
<section id="minimum-working-example">
<h2>Minimum working example<a class="headerlink" href="#minimum-working-example" title="Permalink to this heading">#</a></h2>
<div class="tab-set docutils">
<input checked="True" class="tab-input" id="tab-set--1-input--1" name="tab-set--1" type="radio"><label class="tab-label" for="tab-set--1-input--1">Pythonic style</label><div class="tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jina</span> <span class="kn">import</span> <span class="n">Flow</span><span class="p">,</span> <span class="n">Executor</span><span class="p">,</span> <span class="n">requests</span><span class="p">,</span> <span class="n">Document</span>


<span class="k">class</span> <span class="nc">MyExecutor</span><span class="p">(</span><span class="n">Executor</span><span class="p">):</span>
    <span class="nd">@requests</span><span class="p">(</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;/bar&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>


<span class="n">f</span> <span class="o">=</span> <span class="n">Flow</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;myexec1&#39;</span><span class="p">,</span> <span class="n">uses</span><span class="o">=</span><span class="n">MyExecutor</span><span class="p">)</span>

<span class="k">with</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;/bar&#39;</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">Document</span><span class="p">(),</span> <span class="n">on_done</span><span class="o">=</span><span class="nb">print</span><span class="p">)</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--1-input--2" name="tab-set--1" type="radio"><label class="tab-label" for="tab-set--1-input--2">Flow-as-a-Service style</label><div class="tab-content docutils">
<p>Server:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jina</span> <span class="kn">import</span> <span class="n">Flow</span><span class="p">,</span> <span class="n">Executor</span><span class="p">,</span> <span class="n">requests</span>


<span class="k">class</span> <span class="nc">MyExecutor</span><span class="p">(</span><span class="n">Executor</span><span class="p">):</span>
    <span class="nd">@requests</span><span class="p">(</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;/bar&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>


<span class="n">f</span> <span class="o">=</span> <span class="n">Flow</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="mi">12345</span><span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;myexec1&#39;</span><span class="p">,</span> <span class="n">uses</span><span class="o">=</span><span class="n">MyExecutor</span><span class="p">)</span>

<span class="k">with</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">block</span><span class="p">()</span>
</pre></div>
</div>
<p>Client:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jina</span> <span class="kn">import</span> <span class="n">Client</span><span class="p">,</span> <span class="n">Document</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="mi">12345</span><span class="p">)</span>
<span class="n">c</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;/bar&#39;</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">Document</span><span class="p">(),</span> <span class="n">on_done</span><span class="o">=</span><span class="nb">print</span><span class="p">)</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--1-input--3" name="tab-set--1" type="radio"><label class="tab-label" for="tab-set--1-input--3">Load from YAML</label><div class="tab-content docutils">
<p><code class="docutils literal notranslate"><span class="pre">my.yml</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">jtype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Flow</span><span class="w"></span>
<span class="nt">executors</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myexec1</span><span class="w"></span>
<span class="w">    </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FooExecutor</span><span class="w"></span>
<span class="w">    </span><span class="nt">py_modules</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exec.py</span><span class="w"></span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">exec.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jina</span> <span class="kn">import</span> <span class="n">Executor</span><span class="p">,</span> <span class="n">requests</span><span class="p">,</span> <span class="n">Document</span><span class="p">,</span> <span class="n">DocumentArray</span>


<span class="k">class</span> <span class="nc">FooExecutor</span><span class="p">(</span><span class="n">Executor</span><span class="p">):</span>
    <span class="nd">@requests</span>
    <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">:</span> <span class="n">DocumentArray</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">docs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Document</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;foo was here&#39;</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jina</span> <span class="kn">import</span> <span class="n">Flow</span><span class="p">,</span> <span class="n">Document</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">Flow</span><span class="o">.</span><span class="n">load_config</span><span class="p">(</span><span class="s1">&#39;my.yml&#39;</span><span class="p">)</span>

<span class="k">with</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;/bar&#39;</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">Document</span><span class="p">(),</span> <span class="n">on_done</span><span class="o">=</span><span class="nb">print</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="c1"># handle exception</span>
        <span class="k">pass</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>The statement <code class="docutils literal notranslate"><span class="pre">with</span> <span class="pre">f:</span></code> starts the Flow, and exiting the indented with block stops the Flow, including all Executors defined in it.
Exceptions raised inside the <code class="docutils literal notranslate"><span class="pre">with</span> <span class="pre">f:</span></code> block will close the Flow context manager. If you don’t want this, use a <code class="docutils literal notranslate"><span class="pre">try...except</span></code> block to surround the statements that could potentially raise an exception.</p>
</div>
</section>
<section id="start-and-stop">
<h2>Start and stop<a class="headerlink" href="#start-and-stop" title="Permalink to this heading">#</a></h2>
<p>When a <code class="xref py py-class docutils literal notranslate"><span class="pre">Flow</span></code> starts, all included Executors (single for a Deployment, multiple for a Flow) will start as well, making it possible to <a class="reference internal" href="../../client/third-party-clients/#third-party-client"><span class="std std-ref">reach the service through its API</span></a>.</p>
<p>There are three ways to start an Flow: In Python, from a YAML file, or from the terminal.</p>
<ul class="simple">
<li><p>Generally in Python: use Deployment or Flow as a context manager in Python.</p></li>
<li><p>As an entrypoint from terminal: use <code class="docutils literal notranslate"><span class="pre">Jina</span> <span class="pre">CLI</span> <span class="pre">&lt;cli&gt;</span></code> and a Deployment or Flow YAML file.</p></li>
<li><p>As an entrypoint from Python code: use Flow as a context manager inside <code class="docutils literal notranslate"><span class="pre">if</span> <span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">'__main__'</span></code></p></li>
<li><p>No context manager: manually call <code class="xref py py-meth docutils literal notranslate"><span class="pre">start()</span></code> and <code class="xref py py-meth docutils literal notranslate"><span class="pre">close()</span></code>.</p></li>
</ul>
<div class="tab-set docutils">
<input checked="True" class="tab-input" id="tab-set--2-input--1" name="tab-set--2" type="radio"><label class="tab-label" for="tab-set--2-input--1">General in Python</label><div class="tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jina</span> <span class="kn">import</span> <span class="n">Flow</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">Flow</span><span class="p">()</span>

<span class="k">with</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--2-input--2" name="tab-set--2" type="radio"><label class="tab-label" for="tab-set--2-input--2">Jina CLI entrypoint</label><div class="tab-content docutils">
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>jina flow --uses flow.yml
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--2-input--3" name="tab-set--2" type="radio"><label class="tab-label" for="tab-set--2-input--3">Python entrypoint</label><div class="tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jina</span> <span class="kn">import</span> <span class="n">Flow</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">Flow</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">pass</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--2-input--4" name="tab-set--2" type="radio"><label class="tab-label" for="tab-set--2-input--4">Python no context manager</label><div class="tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jina</span> <span class="kn">import</span> <span class="n">Flow</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">Flow</span><span class="p">()</span>

<span class="n">f</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>The statement <code class="docutils literal notranslate"><span class="pre">with</span> <span class="pre">f:</span></code> starts the Flow, and exiting the indented <code class="docutils literal notranslate"><span class="pre">with</span></code> block stops the Flow, including all its Executors.</p>
<p>A successful start of a Flow looks like this:</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../../../_images/success-flow.png"><img alt="../../../_images/success-flow.png" src="../../../_images/success-flow.png" style="width: 469.7px; height: 159.6px;" /></a>
</figure>
<p>Your addresses and entrypoints can be found in the output. When you enable more features such as monitoring, HTTP gateway, TLS encryption, this display expands to contain more information.</p>
<div class="warning admonition">
<p class="admonition-title">Multiprocessing spawn</p>
<p>Some corner cases require forcing a <code class="docutils literal notranslate"><span class="pre">spawn</span></code> start method for multiprocessing, for example if you encounter “Cannot re-initialize CUDA in forked subprocess”. Read <a class="reference internal" href="../troubleshooting-on-multiprocess/#multiprocessing-spawn"><span class="std std-ref">more in the docs</span></a></p>
</div>
</section>
<section id="serve">
<h2>Serve<a class="headerlink" href="#serve" title="Permalink to this heading">#</a></h2>
<section id="serve-forever">
<h3>Serve forever<a class="headerlink" href="#serve-forever" title="Permalink to this heading">#</a></h3>
<p>In most scenarios, a Flow should remain reachable for prolonged periods of time. This can be achieved from Python or the terminal:</p>
<div class="tab-set docutils">
<input checked="True" class="tab-input" id="tab-set--3-input--1" name="tab-set--3" type="radio"><label class="tab-label" for="tab-set--3-input--1">Python</label><div class="tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jina</span> <span class="kn">import</span> <span class="n">Flow</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">Flow</span><span class="p">()</span>

<span class="k">with</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">block</span><span class="p">()</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">.block()</span></code> method blocks the execution of the current thread or process, enabling external clients to access the Flow.</p>
</div>
<input class="tab-input" id="tab-set--3-input--2" name="tab-set--3" type="radio"><label class="tab-label" for="tab-set--3-input--2">Terminal</label><div class="tab-content docutils">
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>jina flow --uses flow.yml
</pre></div>
</div>
</div>
</div>
<p>In this case, the Flow can be stopped by interrupting the thread or process.</p>
</section>
<section id="serve-until-an-event">
<h3>Serve until an event<a class="headerlink" href="#serve-until-an-event" title="Permalink to this heading">#</a></h3>
<p>Alternatively, a <code class="docutils literal notranslate"><span class="pre">multiprocessing</span></code> or <code class="docutils literal notranslate"><span class="pre">threading</span></code> <code class="docutils literal notranslate"><span class="pre">Event</span></code> object can be passed to <code class="docutils literal notranslate"><span class="pre">.block()</span></code>, which stops the Flow once set.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jina</span> <span class="kn">import</span> <span class="n">Flow</span>
<span class="kn">import</span> <span class="nn">threading</span>


<span class="k">def</span> <span class="nf">start_flow</span><span class="p">(</span><span class="n">stop_event</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;start a blocking Flow.&quot;&quot;&quot;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">Flow</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">block</span><span class="p">(</span><span class="n">stop_event</span><span class="o">=</span><span class="n">stop_event</span><span class="p">)</span>


<span class="n">e</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>  <span class="c1"># create new Event</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Blocked-Flow&#39;</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="n">start_flow</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">e</span><span class="p">,))</span>
<span class="n">t</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>  <span class="c1"># start Flow in new Thread</span>

<span class="c1"># do some stuff</span>

<span class="n">e</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>  <span class="c1"># set event and stop (unblock) the Flow</span>
</pre></div>
</div>
</section>
<section id="serve-on-google-colab">
<h3>Serve on Google Colab<a class="headerlink" href="#serve-on-google-colab" title="Permalink to this heading">#</a></h3>
<p><a class="reference external" href="https://colab.research.google.com/">Google Colab</a> provides an easy-to-use Jupyter notebook environment with GPU/TPU support. Flows are fully compatible with Google Colab and you can use it in the following ways:</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../../../_images/jina-on-colab.svg"><img alt="../../../_images/jina-on-colab.svg" src="../../../_images/jina-on-colab.svg" width="70%" /></a>
</figure>
<p class="sd-text-center"><a class="sd-sphinx-override sd-btn sd-text-wrap sd-btn-primary reference external" href="https://colab.research.google.com/github/jina-ai/jina/blob/master/docs/Using_Jina_on_Colab.ipynb"><span><svg version="1.1" width="1.0em" height="1.0em" class="sd-octicon sd-octicon-link-external" viewBox="0 0 16 16" aria-hidden="true"><path fill-rule="evenodd" d="M10.604 1h4.146a.25.25 0 01.25.25v4.146a.25.25 0 01-.427.177L13.03 4.03 9.28 7.78a.75.75 0 01-1.06-1.06l3.75-3.75-1.543-1.543A.25.25 0 0110.604 1zM3.75 2A1.75 1.75 0 002 3.75v8.5c0 .966.784 1.75 1.75 1.75h8.5A1.75 1.75 0 0014 12.25v-3.5a.75.75 0 00-1.5 0v3.5a.25.25 0 01-.25.25h-8.5a.25.25 0 01-.25-.25v-8.5a.25.25 0 01.25-.25h3.5a.75.75 0 000-1.5h-3.5z"></path></svg> Open the notebook on Google Colab </span></a></p>
<p>Please follow the walkthrough and enjoy the free GPU/TPU!</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Hosing services on Google Colab is not recommended if your server aims to be long-lived or permanent. It is often used for quick experiments, demonstrations or leveraging its free GPU/TPU. For stable, secure and free hosting of your Flow, check out <a class="reference external" href="https://docs.jina.ai/concepts/jcloud/">JCloud</a>.</p>
</div>
</section>
</section>
<section id="export">
<h2>Export<a class="headerlink" href="#export" title="Permalink to this heading">#</a></h2>
<p>A Flow YAML can be exported as a Docker Compose YAML or Kubernetes YAML bundle.</p>
<section id="docker-compose">
<span id="docker-compose-export"></span><h3>Docker Compose<a class="headerlink" href="#docker-compose" title="Permalink to this heading">#</a></h3>
<div class="tab-set docutils">
<input checked="True" class="tab-input" id="tab-set--4-input--1" name="tab-set--4" type="radio"><label class="tab-label" for="tab-set--4-input--1">Python</label><div class="tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jina</span> <span class="kn">import</span> <span class="n">Flow</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">Flow</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">to_docker_compose_yaml</span><span class="p">()</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--4-input--2" name="tab-set--4" type="radio"><label class="tab-label" for="tab-set--4-input--2">Terminal</label><div class="tab-content docutils">
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>jina <span class="nb">export</span> docker-compose flow.yml docker-compose.yml 
</pre></div>
</div>
</div>
</div>
<p>This will generate a single <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file.</p>
<p>For advanced utilization of Docker Compose with Jina, refer to <a class="reference internal" href="../../../cloud-nativeness/docker-compose/#docker-compose"><span class="std std-ref">How to</span></a></p>
</section>
<section id="kubernetes">
<span id="kubernetes-export"></span><h3>Kubernetes<a class="headerlink" href="#kubernetes" title="Permalink to this heading">#</a></h3>
<div class="tab-set docutils">
<input checked="True" class="tab-input" id="tab-set--5-input--1" name="tab-set--5" type="radio"><label class="tab-label" for="tab-set--5-input--1">Python</label><div class="tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jina</span> <span class="kn">import</span> <span class="n">Flow</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">Flow</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">to_kubernetes_yaml</span><span class="p">(</span><span class="s1">&#39;flow_k8s_configuration&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--5-input--2" name="tab-set--5" type="radio"><label class="tab-label" for="tab-set--5-input--2">Terminal</label><div class="tab-content docutils">
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>jina <span class="nb">export</span> kubernetes flow.yml ./my-k8s 
</pre></div>
</div>
</div>
</div>
<p>The generated folder can be used directly with <code class="docutils literal notranslate"><span class="pre">kubectl</span></code> to deploy the Flow to an existing Kubernetes cluster.</p>
<p>For advanced utilisation of Kubernetes with Jina please refer to <a class="reference internal" href="../../../cloud-nativeness/kubernetes/#kubernetes"><span class="std std-ref">How to</span></a></p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Based on your local Jina version, Executor Hub may rebuild the Docker image during the YAML generation process.
If you do not wish to rebuild the image, set the environment variable <code class="docutils literal notranslate"><span class="pre">JINA_HUB_NO_IMAGE_REBUILD</span></code>.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If an Executor requires volumes to be mapped to persist data, Jina will create a StatefulSet for that Executor instead of a Deployment.
You can control the access mode, storage class name and capacity of the attached Persistent Volume Claim by using <a class="reference internal" href="../../../envs/#jina-env-vars"><span class="std std-ref">Jina environment variables</span></a><br />
<code class="docutils literal notranslate"><span class="pre">JINA_K8S_ACCESS_MODES</span></code>, <code class="docutils literal notranslate"><span class="pre">JINA_K8S_STORAGE_CLASS_NAME</span></code> and <code class="docutils literal notranslate"><span class="pre">JINA_K8S_STORAGE_CAPACITY</span></code>. Only the first volume will be considered to be mounted.</p>
</div>
<div class="seealso admonition">
<p class="admonition-title">See also</p>
<p>For more in-depth guides on Flow deployment, check our how-tos for <a class="reference internal" href="../../../cloud-nativeness/docker-compose/#docker-compose"><span class="std std-ref">Docker compose</span></a> and <a class="reference internal" href="../../../cloud-nativeness/kubernetes/#kubernetes"><span class="std std-ref">Kubernetes</span></a>.</p>
</div>
</section>
</section>
<section id="add-executors">
<h2>Add Executors<a class="headerlink" href="#add-executors" title="Permalink to this heading">#</a></h2>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>This section is for Flow-specific considerations when working with Executors. Check more information on <a class="reference internal" href="../add-executors/#add-executors"><span class="std std-ref">working with Executors</span></a>.</p>
</div>
<p>A <code class="xref py py-class docutils literal notranslate"><span class="pre">Flow</span></code> orchestrates its <code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code>s as a graph and sends requests to all Executors in the order specified by <code class="xref py py-meth docutils literal notranslate"><span class="pre">add()</span></code> or listed in <a class="reference internal" href="../yaml-spec/#flow-yaml-spec"><span class="std std-ref">a YAML file</span></a>.</p>
<p>When you start a Flow, Executors always run in <strong>separate processes</strong>. Multiple Executors run in <strong>different processes</strong>. Multiprocessing is the lowest level of separation when you run a Flow locally. When running a Flow on Kubernetes, Docker Swarm, <a class="reference internal" href="../../jcloud/#jcloud"><span class="std std-ref">Jina AI Cloud Hosting</span></a>, different Executors run in different containers, pods or instances.</p>
<p>Executors can be added into a Flow with <code class="xref py py-meth docutils literal notranslate"><span class="pre">add()</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jina</span> <span class="kn">import</span> <span class="n">Flow</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">Flow</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">()</span>
</pre></div>
</div>
<p>This adds an “empty” Executor called <code class="xref py py-class docutils literal notranslate"><span class="pre">BaseExecutor</span></code> to the Flow. This Executor (without any parameters) performs no actions.</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../../../_images/no-op-flow.svg"><img alt="../../../_images/no-op-flow.svg" src="../../../_images/no-op-flow.svg" /></a>
</figure>
<p>To more easily identify an Executor, you can change its name by passing the <code class="docutils literal notranslate"><span class="pre">name</span></code> parameter:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jina</span> <span class="kn">import</span> <span class="n">Flow</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">Flow</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;myVeryFirstExecutor&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;secondIsBest&#39;</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-default">
<a class="reference internal image-reference" href="../../../_images/named-flow.svg"><img alt="../../../_images/named-flow.svg" src="../../../_images/named-flow.svg" /></a>
</figure>
<p>You can also define the above Flow in YAML:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">jtype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Flow</span><span class="w"></span>
<span class="nt">executors</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myVeryFirstExecutor</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">secondIsBest</span><span class="w"></span>
</pre></div>
</div>
<p>Save it as <code class="docutils literal notranslate"><span class="pre">flow.yml</span></code> and run it:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>jina flow --uses flow.yml
</pre></div>
</div>
<p>More Flow YAML specifications can be found in <a class="reference internal" href="../yaml-spec/#flow-yaml-spec"><span class="std std-ref">Flow YAML Specification</span></a>.</p>
<section id="how-executors-process-documentarrays-in-a-flow">
<h3>How Executors process DocumentArrays in a Flow<a class="headerlink" href="#how-executors-process-documentarrays-in-a-flow" title="Permalink to this heading">#</a></h3>
<p>Let’s understand how Executors process DocumentArray’s inside a Flow, and how changes are chained and applied, affecting downstream Executors in the Flow.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jina</span> <span class="kn">import</span> <span class="n">Executor</span><span class="p">,</span> <span class="n">requests</span><span class="p">,</span> <span class="n">Flow</span><span class="p">,</span> <span class="n">DocumentArray</span><span class="p">,</span> <span class="n">Document</span>


<span class="k">class</span> <span class="nc">PrintDocuments</span><span class="p">(</span><span class="n">Executor</span><span class="p">):</span>
    <span class="nd">@requests</span>
    <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39; PrintExecutor: received document with text: &quot;</span><span class="si">{</span><span class="n">doc</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ProcessDocuments</span><span class="p">(</span><span class="n">Executor</span><span class="p">):</span>
    <span class="nd">@requests</span><span class="p">(</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;/change_in_place&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">in_place</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># This Executor only works on `docs` and doesn&#39;t consider any other arguments</span>
        <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39; ProcessDocuments: received document with text &quot;</span><span class="si">{</span><span class="n">doc</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;I changed the executor in place&#39;</span>

    <span class="nd">@requests</span><span class="p">(</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;/return_different_docarray&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">ret_docs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># This executor only works on `docs` and doesn&#39;t consider any other arguments</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">DocumentArray</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39; ProcessDocuments: received document with text: &quot;</span><span class="si">{</span><span class="n">doc</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Document</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;I returned a different Document&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ret</span>


<span class="n">f</span> <span class="o">=</span> <span class="n">Flow</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">uses</span><span class="o">=</span><span class="n">ProcessDocuments</span><span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">uses</span><span class="o">=</span><span class="n">PrintDocuments</span><span class="p">)</span>

<span class="k">with</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;/change_in_place&#39;</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">DocumentArray</span><span class="p">(</span><span class="n">Document</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;request1&#39;</span><span class="p">)))</span>
    <span class="n">f</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
        <span class="n">on</span><span class="o">=</span><span class="s1">&#39;/return_different_docarray&#39;</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">DocumentArray</span><span class="p">(</span><span class="n">Document</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;request2&#39;</span><span class="p">))</span>
    <span class="p">)</span>
</pre></div>
</div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>────────────────────────── 🎉 Flow is ready to serve! ──────────────────────────
╭────────────── 🔗 Endpoint ───────────────╮
│  ⛓     Protocol                    GRPC  │
│  🏠       Local           <span class="m">0</span>.0.0.0:58746  │
│  🔒     Private     <span class="m">192</span>.168.1.187:58746  │
│  🌍      Public    <span class="m">212</span>.231.186.65:58746  │
╰──────────────────────────────────────────╯

 ProcessDocuments: received document with text <span class="s2">&quot;request1&quot;</span>
 PrintExecutor: received document with text: <span class="s2">&quot;I changed the executor in place&quot;</span>
 ProcessDocuments: received document with text: <span class="s2">&quot;request2&quot;</span>
 PrintExecutor: received document with text: <span class="s2">&quot;I returned a different Document&quot;</span>
</pre></div>
</div>
</section>
<section id="define-topologies-over-executors">
<h3>Define topologies over Executors<a class="headerlink" href="#define-topologies-over-executors" title="Permalink to this heading">#</a></h3>
<p><code class="xref py py-class docutils literal notranslate"><span class="pre">Flow</span></code>s are not restricted to sequential execution. Internally they are modeled as graphs, so they can represent any complex, non-cyclic topology.</p>
<p>A typical use case for such a Flow is a topology with a common pre-processing part, but different indexers separating embeddings and data.</p>
<p>To define a custom topology you can use the <code class="docutils literal notranslate"><span class="pre">needs</span></code> keyword when adding an <code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code>. By default, a Flow assumes that every Executor needs the previously added Executor.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jina</span> <span class="kn">import</span> <span class="n">Executor</span><span class="p">,</span> <span class="n">Flow</span><span class="p">,</span> <span class="n">requests</span><span class="p">,</span> <span class="n">Document</span><span class="p">,</span> <span class="n">DocumentArray</span>


<span class="k">class</span> <span class="nc">FooExecutor</span><span class="p">(</span><span class="n">Executor</span><span class="p">):</span>
    <span class="nd">@requests</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">:</span> <span class="n">DocumentArray</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">docs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Document</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;foo was here and got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span><span class="si">}</span><span class="s1"> document&#39;</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">BarExecutor</span><span class="p">(</span><span class="n">Executor</span><span class="p">):</span>
    <span class="nd">@requests</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">bar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">:</span> <span class="n">DocumentArray</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">docs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Document</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;bar was here and got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span><span class="si">}</span><span class="s1"> document&#39;</span><span class="p">))</span>


<span class="k">class</span> <span class="nc">BazExecutor</span><span class="p">(</span><span class="n">Executor</span><span class="p">):</span>
    <span class="nd">@requests</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">baz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">:</span> <span class="n">DocumentArray</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">docs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Document</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;baz was here and got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span><span class="si">}</span><span class="s1"> document&#39;</span><span class="p">))</span>


<span class="n">f</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">Flow</span><span class="p">()</span>
    <span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">uses</span><span class="o">=</span><span class="n">FooExecutor</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;fooExecutor&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">uses</span><span class="o">=</span><span class="n">BarExecutor</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;barExecutor&#39;</span><span class="p">,</span> <span class="n">needs</span><span class="o">=</span><span class="s1">&#39;fooExecutor&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">uses</span><span class="o">=</span><span class="n">BazExecutor</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;bazExecutor&#39;</span><span class="p">,</span> <span class="n">needs</span><span class="o">=</span><span class="s1">&#39;fooExecutor&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">needs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;barExecutor&#39;</span><span class="p">,</span> <span class="s1">&#39;bazExecutor&#39;</span><span class="p">])</span>
<span class="p">)</span>
</pre></div>
</div>
<figure class="align-center" id="id2">
<a class="reference internal image-reference" href="../../../_images/needs-flow.svg"><img alt="../../../_images/needs-flow.svg" src="../../../_images/needs-flow.svg" width="70%" /></a>
<figcaption>
<p><span class="caption-text">Complex Flow where one Executor requires two Executors to process Documents beforehand</span><a class="headerlink" href="#id2" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>When sending message to this Flow,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">f</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">texts</span><span class="p">)</span>
</pre></div>
</div>
<p>This gives the output:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>[&#39;foo was here and got 0 document&#39;, &#39;bar was here and got 1 document&#39;, &#39;baz was here and got 1 document&#39;]
</pre></div>
</div>
<p>Both <code class="docutils literal notranslate"><span class="pre">BarExecutor</span></code> and <code class="docutils literal notranslate"><span class="pre">BazExecutor</span></code> only received a single <code class="docutils literal notranslate"><span class="pre">Document</span></code> from <code class="docutils literal notranslate"><span class="pre">FooExecutor</span></code> because they are run in parallel. The last Executor <code class="docutils literal notranslate"><span class="pre">executor3</span></code> receives both DocumentArrays and merges them automatically.
This automated merging can be disabled with <code class="docutils literal notranslate"><span class="pre">no_reduce=True</span></code>. This is useful for providing custom merge logic in a separate Executor. In this case the last <code class="docutils literal notranslate"><span class="pre">.add()</span></code> call would look like <code class="docutils literal notranslate"><span class="pre">.add(needs=['barExecutor',</span> <span class="pre">'bazExecutor'],</span> <span class="pre">uses=CustomMergeExecutor,</span> <span class="pre">no_reduce=True)</span></code>. This feature requires Jina &gt;= 3.0.2.</p>
</section>
<section id="floating-executors">
<span id="id1"></span><h3>Floating Executors<a class="headerlink" href="#floating-executors" title="Permalink to this heading">#</a></h3>
<p>Some Executors in your Flow can be used for asynchronous background tasks that take time and don’t generate a required output. For instance,
logging specific information in external services, storing partial results, etc.</p>
<p>You can unblock your Flow from such tasks by using <em>floating Executors</em>.</p>
<p>Normally, all Executors form a pipeline that handles and transforms a given request until it is finally returned to the Client.</p>
<p>However, floating Executors do not feed their outputs back into the pipeline. Therefore, the Executor’s output does not affect the response for the Client, and the response can be returned without waiting for the floating Executor to complete its task.</p>
<p>Those Executors are marked with the <code class="docutils literal notranslate"><span class="pre">floating</span></code> keyword when added to a <code class="docutils literal notranslate"><span class="pre">Flow</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">jina</span> <span class="kn">import</span> <span class="n">Flow</span><span class="p">,</span> <span class="n">Executor</span><span class="p">,</span> <span class="n">requests</span><span class="p">,</span> <span class="n">DocumentArray</span>


<span class="k">class</span> <span class="nc">FastChangingExecutor</span><span class="p">(</span><span class="n">Executor</span><span class="p">):</span>
    <span class="nd">@requests</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">:</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;Hello World&#39;</span>


<span class="k">class</span> <span class="nc">SlowChangingExecutor</span><span class="p">(</span><span class="n">Executor</span><span class="p">):</span>
    <span class="nd">@requests</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39; Received </span><span class="si">{</span><span class="n">docs</span><span class="o">.</span><span class="n">texts</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">:</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;Change the document but will not affect response&#39;</span>


<span class="n">f</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">Flow</span><span class="p">()</span>
    <span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;executor0&#39;</span><span class="p">,</span> <span class="n">uses</span><span class="o">=</span><span class="n">FastChangingExecutor</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;floating_executor&#39;</span><span class="p">,</span>
        <span class="n">uses</span><span class="o">=</span><span class="n">SlowChangingExecutor</span><span class="p">,</span>
        <span class="n">needs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;gateway&#39;</span><span class="p">],</span>
        <span class="n">floating</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="k">with</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;/endpoint&#39;</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">DocumentArray</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>  <span class="c1"># we need to send a first</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;/endpoint&#39;</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">DocumentArray</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39; Response time took </span><span class="si">{</span><span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span><span class="si">}</span><span class="s1">s&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">texts</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span> Response time took 0.011997222900390625s
 [&#39;Hello World&#39;, &#39;Hello World&#39;]
 Received [&#39;Hello World&#39;, &#39;Hello World&#39;]
</pre></div>
</div>
<p>In this example the response is returned without waiting for the floating Executor to complete. However, the Flow is not closed until
the floating Executor has handled the request.</p>
<p>You can plot the Flow and see the Executor is floating disconnected from the <strong>Gateway</strong>.</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../../../_images/flow_floating.svg"><img alt="../../../_images/flow_floating.svg" src="../../../_images/flow_floating.svg" width="70%" /></a>
</figure>
<p>A floating Executor can <em>never</em> come before a non-floating Executor in your Flow’s <span class="xref std std-ref">topology</span>.</p>
<p>This leads to the following behaviors:</p>
<ul class="simple">
<li><p><strong>Implicit reordering</strong>: When you add a non-floating Executor after a floating Executor without specifying its <code class="docutils literal notranslate"><span class="pre">needs</span></code> parameter, the non-floating Executor is chained after the previous non-floating one.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jina</span> <span class="kn">import</span> <span class="n">Flow</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">Flow</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;middle&#39;</span><span class="p">,</span> <span class="n">floating</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default">
<a class="reference internal image-reference" href="../../../_images/flow_middle_1.svg"><img alt="../../../_images/flow_middle_1.svg" src="../../../_images/flow_middle_1.svg" width="70%" /></a>
</figure>
<ul class="simple">
<li><p><strong>Chaining floating Executors</strong>: To chain more than one floating Executor, you need to add all of them with the <code class="docutils literal notranslate"><span class="pre">floating</span></code> flag, and explicitly specify the <code class="docutils literal notranslate"><span class="pre">needs</span></code> argument.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jina</span> <span class="kn">import</span> <span class="n">Flow</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">Flow</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;middle&#39;</span><span class="p">,</span> <span class="n">floating</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">needs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;middle&#39;</span><span class="p">],</span> <span class="n">floating</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default">
<a class="reference internal image-reference" href="../../../_images/flow_chain_floating.svg"><img alt="../../../_images/flow_chain_floating.svg" src="../../../_images/flow_chain_floating.svg" width="70%" /></a>
</figure>
<ul class="simple">
<li><p><strong>Overriding the <code class="docutils literal notranslate"><span class="pre">floating</span></code> flag</strong>: If you add a floating Executor as part of <code class="docutils literal notranslate"><span class="pre">needs</span></code> parameter of a non-floating Executor, then the floating Executor is no longer considered floating.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jina</span> <span class="kn">import</span> <span class="n">Flow</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">Flow</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;middle&#39;</span><span class="p">,</span> <span class="n">floating</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">needs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;middle&#39;</span><span class="p">])</span>
<span class="n">f</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<figure class="align-default">
<a class="reference internal image-reference" href="../../../_images/flow_cancel_floating.svg"><img alt="../../../_images/flow_cancel_floating.svg" src="../../../_images/flow_cancel_floating.svg" width="70%" /></a>
</figure>
</section>
<section id="add-conditioning">
<span id="conditioning"></span><h3>Add Conditioning<a class="headerlink" href="#add-conditioning" title="Permalink to this heading">#</a></h3>
<p>Sometimes you may not want all Documents to be processed by all Executors. For example when you process text and image Documents you want to forward them to different Executors depending on their data type.</p>
<p>You can set conditioning for every <code class="xref py py-class docutils literal notranslate"><span class="pre">Executor</span></code> in the Flow. Documents that don’t meet the condition will be removed before reaching that Executor. This allows you to build a selection control in the Flow.</p>
<section id="define-conditions">
<h4>Define conditions<a class="headerlink" href="#define-conditions" title="Permalink to this heading">#</a></h4>
<p>To add a condition to an Executor, pass it to the <code class="docutils literal notranslate"><span class="pre">when</span></code> parameter of <code class="xref py py-meth docutils literal notranslate"><span class="pre">add()</span></code> method of the Flow. This then defines <em>when</em> a Document is processed by the Executor:</p>
<p>You can use the <a class="reference external" href="https://docarray.jina.ai/fundamentals/documentarray/find/#query-by-conditions">DocArray query language</a> to specify a filter condition for each Executor.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jina</span> <span class="kn">import</span> <span class="n">Flow</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">Flow</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">when</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;tags__key&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;$eq&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}})</span>
</pre></div>
</div>
<p>Then only Documents that satisfy the <code class="docutils literal notranslate"><span class="pre">when</span></code> condition will reach the associated Executor. Any Documents that don’t satisfy that condition won’t reach the Executor.</p>
<p>If you are trying to separate Documents according to the data modality they hold, you need to choose a condition accordingly.</p>
<div class="seealso admonition">
<p class="admonition-title">See Also</p>
<p>In addition to <code class="docutils literal notranslate"><span class="pre">$exists</span></code> you can use a number of other operators to define your filter: <code class="docutils literal notranslate"><span class="pre">$eq</span></code>, <code class="docutils literal notranslate"><span class="pre">$gte</span></code>, <code class="docutils literal notranslate"><span class="pre">$lte</span></code>, <code class="docutils literal notranslate"><span class="pre">$size</span></code>, <code class="docutils literal notranslate"><span class="pre">$and</span></code>, <code class="docutils literal notranslate"><span class="pre">$or</span></code> and many more. For details, consult this <a class="reference external" href="https://docarray.jina.ai/fundamentals/documentarray/find/#query-by-conditions">DocArray documentation page</a>.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># define filter conditions</span>
<span class="n">text_condition</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;$exists&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}}</span>
<span class="n">tensor_condition</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tensor&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;$exists&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}}</span>
</pre></div>
</div>
<p>These conditions specify that only Documents that hold data of a specific modality can pass the filter.</p>
<div class="tab-set docutils">
<input checked="True" class="tab-input" id="tab-set--6-input--1" name="tab-set--6" type="radio"><label class="tab-label" for="tab-set--6-input--1">Python</label><div class="tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jina</span> <span class="kn">import</span> <span class="n">Flow</span><span class="p">,</span> <span class="n">DocumentArray</span><span class="p">,</span> <span class="n">Document</span>

<span class="hll"><span class="n">f</span> <span class="o">=</span> <span class="n">Flow</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">when</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;tags__key&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;$eq&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}})</span>  <span class="c1"># Create the empty Flow, add condition</span>
</span>
<span class="k">with</span> <span class="n">f</span><span class="p">:</span>  <span class="c1"># Using it as a Context Manager starts the Flow</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
        <span class="n">on</span><span class="o">=</span><span class="s1">&#39;/search&#39;</span><span class="p">,</span>
<span class="hll">        <span class="n">inputs</span><span class="o">=</span><span class="n">DocumentArray</span><span class="p">([</span><span class="n">Document</span><span class="p">(</span><span class="n">tags</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}),</span> <span class="n">Document</span><span class="p">(</span><span class="n">tags</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">})]),</span>
</span>    <span class="p">)</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="n">ret</span><span class="p">[:,</span> <span class="s1">&#39;tags&#39;</span><span class="p">]</span>
<span class="p">)</span>  <span class="c1"># only the Document fulfilling the condition is processed and therefore returned.</span>
</pre></div>
</div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">[{</span><span class="s1">&#39;key&#39;</span>: <span class="m">5</span>.0<span class="o">}]</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--6-input--2" name="tab-set--6" type="radio"><label class="tab-label" for="tab-set--6-input--2">YAML</label><div class="tab-content docutils">
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">jtype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Flow</span><span class="w"></span>
<span class="nt">executors</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">executor</span><span class="w"></span>
<span class="w">    </span><span class="nt">when</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">tags__key</span><span class="p">:</span><span class="w"></span>
<span class="w">            </span><span class="nt">$eq</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">docarray</span> <span class="kn">import</span> <span class="n">DocumentArray</span><span class="p">,</span> <span class="n">Document</span>
<span class="kn">from</span> <span class="nn">jina</span> <span class="kn">import</span> <span class="n">Flow</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">Flow</span><span class="o">.</span><span class="n">load_config</span><span class="p">(</span><span class="s1">&#39;flow.yml&#39;</span><span class="p">)</span>  <span class="c1"># Load the Flow definition from Yaml file</span>

<span class="k">with</span> <span class="n">f</span><span class="p">:</span>  <span class="c1"># Using it as a Context Manager starts the Flow</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
        <span class="n">on</span><span class="o">=</span><span class="s1">&#39;/search&#39;</span><span class="p">,</span>
<span class="hll">        <span class="n">inputs</span><span class="o">=</span><span class="n">DocumentArray</span><span class="p">([</span><span class="n">Document</span><span class="p">(</span><span class="n">tags</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}),</span> <span class="n">Document</span><span class="p">(</span><span class="n">tags</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">})]),</span>
</span>    <span class="p">)</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="n">ret</span><span class="p">[:,</span> <span class="s1">&#39;tags&#39;</span><span class="p">]</span>
<span class="p">)</span>  <span class="c1"># only the Document fulfilling the condition is processed and therefore returned.</span>
</pre></div>
</div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">[{</span><span class="s1">&#39;key&#39;</span>: <span class="m">5</span>.0<span class="o">}]</span>
</pre></div>
</div>
</div>
</div>
<p>Note that if a Document does not satisfy the <code class="docutils literal notranslate"><span class="pre">when</span></code> condition of a filter, the filter removes the Document <em>for that entire branch of the Flow</em>.
This means that every Executor located behind a filter is affected by this, not just the specific Executor that defines the condition.
As with a real-life filter, once something fails to pass through it, it no longer continues down the pipeline.</p>
<p>Naturally, parallel branches in a Flow do not affect each other. So if a Document gets filtered out in only one branch, it can
still be used in the other branch, and also after the branches are re-joined:</p>
<div class="tab-set docutils">
<input checked="True" class="tab-input" id="tab-set--7-input--1" name="tab-set--7" type="radio"><label class="tab-label" for="tab-set--7-input--1">Parallel Executors</label><div class="tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jina</span> <span class="kn">import</span> <span class="n">Flow</span><span class="p">,</span> <span class="n">DocumentArray</span><span class="p">,</span> <span class="n">Document</span>

<span class="n">f</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">Flow</span><span class="p">()</span>
    <span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">when</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;tags__key&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;$eq&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}},</span> <span class="n">needs</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;exec1&#39;</span><span class="p">)</span>
<span class="hll">    <span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">when</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;tags__key&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;$eq&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}},</span> <span class="n">needs</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;exec2&#39;</span><span class="p">)</span>
</span><span class="hll">    <span class="o">.</span><span class="n">needs_all</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;join&#39;</span><span class="p">)</span>
</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-center">
<a class="reference internal image-reference" href="../../../_images/conditional-flow.svg"><img alt="../../../_images/conditional-flow.svg" src="../../../_images/conditional-flow.svg" width="70%" /></a>
</figure>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
        <span class="n">on</span><span class="o">=</span><span class="s1">&#39;/search&#39;</span><span class="p">,</span>
        <span class="n">inputs</span><span class="o">=</span><span class="n">DocumentArray</span><span class="p">([</span><span class="n">Document</span><span class="p">(</span><span class="n">tags</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}),</span> <span class="n">Document</span><span class="p">(</span><span class="n">tags</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">})]),</span>
    <span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">ret</span><span class="p">[:,</span> <span class="s1">&#39;tags&#39;</span><span class="p">])</span>  <span class="c1"># Each Document satisfies one parallel branch/filter</span>
</pre></div>
</div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">[{</span><span class="s1">&#39;key&#39;</span>: <span class="m">5</span>.0<span class="o">}</span>, <span class="o">{</span><span class="s1">&#39;key&#39;</span>: <span class="m">4</span>.0<span class="o">}]</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--7-input--2" name="tab-set--7" type="radio"><label class="tab-label" for="tab-set--7-input--2">Sequential Executors</label><div class="tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jina</span> <span class="kn">import</span> <span class="n">Flow</span><span class="p">,</span> <span class="n">DocumentArray</span><span class="p">,</span> <span class="n">Document</span>

<span class="n">f</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">Flow</span><span class="p">()</span>
    <span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">when</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;tags__key&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;$eq&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}},</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;exec1&#39;</span><span class="p">,</span> <span class="n">needs</span><span class="o">=</span><span class="s1">&#39;first&#39;</span><span class="p">)</span>
<span class="hll">    <span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">when</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;tags__key&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;$eq&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">}},</span> <span class="n">needs</span><span class="o">=</span><span class="s1">&#39;exec1&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;exec2&#39;</span><span class="p">)</span>
</span><span class="hll"><span class="p">)</span>
</span></pre></div>
</div>
<figure class="align-default">
<a class="reference internal image-reference" href="../../../_images/sequential-flow.svg"><img alt="../../../_images/sequential-flow.svg" src="../../../_images/sequential-flow.svg" width="70%" /></a>
</figure>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
        <span class="n">on</span><span class="o">=</span><span class="s1">&#39;/search&#39;</span><span class="p">,</span>
        <span class="n">inputs</span><span class="o">=</span><span class="n">DocumentArray</span><span class="p">([</span><span class="n">Document</span><span class="p">(</span><span class="n">tags</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}),</span> <span class="n">Document</span><span class="p">(</span><span class="n">tags</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;key&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">})]),</span>
    <span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">ret</span><span class="p">[:,</span> <span class="s1">&#39;tags&#39;</span><span class="p">])</span>  <span class="c1"># No Document satisfies both sequential filters</span>
</pre></div>
</div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">[]</span>
</pre></div>
</div>
</div>
</div>
<p>This feature is useful to prevent some specialized Executors from processing certain Documents.
It can also be used to build <em>switch-like nodes</em>, where some Documents pass through one branch of the Flow,
while other Documents pass through a different parallel branch.</p>
<p>Note that whenever a Document does not satisfy the condition of an Executor, it is not even sent to that Executor.
Instead, only a tailored Request without any payload is transferred.
This means that you can not only use this feature to build complex logic, but also to minimize your networking overhead.</p>
</section>
<section id="filtering-outside-the-flow">
<h4>Filtering outside the Flow<a class="headerlink" href="#filtering-outside-the-flow" title="Permalink to this heading">#</a></h4>
<p>You can use conditions directly on the data, outside the Flow:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">da</span> <span class="o">=</span> <span class="o">...</span>  <span class="c1"># type: docarray.DocumentArray</span>
<span class="n">filtered_text_data</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">text_condition</span><span class="p">)</span>
<span class="n">filtered_image_data</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">tensor_condition</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">filtered_text_data</span><span class="o">.</span><span class="n">texts</span><span class="p">)</span>  <span class="c1"># print text</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;---&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">filtered_image_data</span><span class="o">.</span><span class="n">tensors</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">[</span><span class="s1">&#39;hey there!&#39;</span>, <span class="s1">&#39;hey there!&#39;</span><span class="o">]</span>
---
<span class="o">[[[</span><span class="m">0</span>.50535537 <span class="m">0</span>.50538128<span class="o">]</span>
  <span class="o">[</span><span class="m">0</span>.40446746 <span class="m">0</span>.34972967<span class="o">]]</span>

 <span class="o">[[</span><span class="m">0</span>.04222604 <span class="m">0</span>.70102327<span class="o">]</span>
  <span class="o">[</span><span class="m">0</span>.12079661 <span class="m">0</span>.65313938<span class="o">]]]</span>
</pre></div>
</div>
<p>Each filter selects Documents that contain the desired data fields.
That’s exactly what you want for your filter!</p>
<div class="seealso admonition">
<p class="admonition-title">See Also</p>
<p>For a hands-on example of leveraging filter conditions, see <span class="xref std std-ref">this how-to</span>.</p>
</div>
<p>To define a filter condition, use <a class="reference external" href="https://docarray.jina.ai/fundamentals/documentarray/find/#query-by-conditions">DocArray’s rich query language</a>.</p>
</section>
</section>
<section id="merging-upstream-documentarrays">
<h3>Merging upstream DocumentArrays<a class="headerlink" href="#merging-upstream-documentarrays" title="Permalink to this heading">#</a></h3>
<p>Often when you’re building a Flow, you want an Executor to receive DocumentArrays from multiple upstream Executors.</p>
<figure class="align-center">
<a class="reference internal image-reference" href="../../../_images/flow-merge-executor.svg"><img alt="../../../_images/flow-merge-executor.svg" src="../../../_images/flow-merge-executor.svg" width="70%" /></a>
</figure>
<p>For this you can use the <code class="docutils literal notranslate"><span class="pre">docs_matrix</span></code> or <code class="docutils literal notranslate"><span class="pre">docs_map</span></code> parameters (part of Executor endpoints signature). These Flow-specific arguments that can be used alongside an Executor’s <a class="reference internal" href="../../executor/add-endpoints/#endpoint-arguments"><span class="std std-ref">default arguments</span></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">from</span> <span class="nn">jina</span> <span class="kn">import</span> <span class="n">Executor</span><span class="p">,</span> <span class="n">requests</span><span class="p">,</span> <span class="n">DocumentArray</span>


<span class="k">class</span> <span class="nc">MergeExec</span><span class="p">(</span><span class="n">Executor</span><span class="p">):</span>
    <span class="nd">@requests</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">docs</span><span class="p">:</span> <span class="n">DocumentArray</span><span class="p">,</span>
        <span class="n">parameters</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>
<span class="hll">        <span class="n">docs_matrix</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">DocumentArray</span><span class="p">]],</span>
</span><span class="hll">        <span class="n">docs_map</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">DocumentArray</span><span class="p">]],</span>
</span>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">DocumentArray</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="k">pass</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Use <code class="docutils literal notranslate"><span class="pre">docs_matrix</span></code> to receive a List of all incoming DocumentArrays from upstream Executors:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
    <span class="n">DocumentArray</span><span class="p">(</span><span class="o">...</span><span class="p">),</span>  <span class="c1"># from Executor1</span>
    <span class="n">DocumentArray</span><span class="p">(</span><span class="o">...</span><span class="p">),</span>  <span class="c1"># from Executor2</span>
    <span class="n">DocumentArray</span><span class="p">(</span><span class="o">...</span><span class="p">),</span>  <span class="c1"># from Executor3</span>
<span class="p">]</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Use <code class="docutils literal notranslate"><span class="pre">docs_map</span></code> to receive a Dict, where each item’s key is the name of an upstream Executor and the value is the DocumentArray coming from that Executor:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s1">&#39;Executor1&#39;</span><span class="p">:</span> <span class="n">DocumentArray</span><span class="p">(</span><span class="o">...</span><span class="p">),</span>
    <span class="s1">&#39;Executor2&#39;</span><span class="p">:</span> <span class="n">DocumentArray</span><span class="p">(</span><span class="o">...</span><span class="p">),</span>
    <span class="s1">&#39;Executor3&#39;</span><span class="p">:</span> <span class="n">DocumentArray</span><span class="p">(</span><span class="o">...</span><span class="p">),</span>
<span class="p">}</span>
</pre></div>
</div>
<section id="reducing-multiple-documentarrays-to-one-documentarray">
<span id="no-reduce"></span><h4>Reducing multiple DocumentArrays to one DocumentArray<a class="headerlink" href="#reducing-multiple-documentarrays-to-one-documentarray" title="Permalink to this heading">#</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">no_reduce</span></code> argument determines whether DocumentArrays are reduced into one when being received:</p>
<ul class="simple">
<li><p>To reduce all incoming DocumentArrays into <strong>one single DocumentArray</strong>, do not set <code class="docutils literal notranslate"><span class="pre">no_reduce</span></code> or set it to <code class="docutils literal notranslate"><span class="pre">False</span></code>. The <code class="docutils literal notranslate"><span class="pre">docs_map</span></code> and <code class="docutils literal notranslate"><span class="pre">docs_matrix</span></code> will be <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p></li>
<li><p>To receive <strong>a list all incoming DocumentArrays</strong> set <code class="docutils literal notranslate"><span class="pre">no_reduce</span></code> to <code class="docutils literal notranslate"><span class="pre">True</span></code>. The Executor will receive the DocumentArrays independently under <code class="docutils literal notranslate"><span class="pre">docs_matrix</span></code> and <code class="docutils literal notranslate"><span class="pre">docs_map</span></code>.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jina</span> <span class="kn">import</span> <span class="n">Flow</span><span class="p">,</span> <span class="n">Executor</span><span class="p">,</span> <span class="n">requests</span><span class="p">,</span> <span class="n">Document</span><span class="p">,</span> <span class="n">DocumentArray</span>


<span class="k">class</span> <span class="nc">Exec1</span><span class="p">(</span><span class="n">Executor</span><span class="p">):</span>
    <span class="nd">@requests</span>
    <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">:</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;Exec1&#39;</span>


<span class="k">class</span> <span class="nc">Exec2</span><span class="p">(</span><span class="n">Executor</span><span class="p">):</span>
    <span class="nd">@requests</span>
    <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">docs</span><span class="p">:</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;Exec2&#39;</span>


<span class="k">class</span> <span class="nc">MergeExec</span><span class="p">(</span><span class="n">Executor</span><span class="p">):</span>
    <span class="nd">@requests</span>
    <span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">docs_matrix</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">documents_to_return</span> <span class="o">=</span> <span class="n">DocumentArray</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">doc1</span><span class="p">,</span> <span class="n">doc2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">docs_matrix</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;MergeExec processing pairs of Documents &quot;</span><span class="si">{</span><span class="n">doc1</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s1">&quot; and &quot;</span><span class="si">{</span><span class="n">doc2</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
            <span class="p">)</span>
            <span class="n">documents_to_return</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">Document</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Document merging from &quot;</span><span class="si">{</span><span class="n">doc1</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s1">&quot; and &quot;</span><span class="si">{</span><span class="n">doc2</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">documents_to_return</span>


<span class="n">f</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">Flow</span><span class="p">()</span>
    <span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">uses</span><span class="o">=</span><span class="n">Exec1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;exec1&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">uses</span><span class="o">=</span><span class="n">Exec2</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;exec2&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">uses</span><span class="o">=</span><span class="n">MergeExec</span><span class="p">,</span> <span class="n">needs</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;exec1&#39;</span><span class="p">,</span> <span class="s1">&#39;exec2&#39;</span><span class="p">],</span> <span class="n">no_reduce</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>

<span class="k">with</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">returned_docs</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">Document</span><span class="p">())</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Resulting documents </span><span class="si">{</span><span class="n">returned_docs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>────────────────────────── 🎉 Flow is ready to serve! ──────────────────────────
╭────────────── 🔗 Endpoint ───────────────╮
│  ⛓     Protocol                    GRPC │
│  🏠       Local           <span class="m">0</span>.0.0.0:55761  │
│  🔒     Private     <span class="m">192</span>.168.1.187:55761  │
│  🌍      Public    <span class="m">212</span>.231.186.65:55761  │
╰──────────────────────────────────────────╯

MergeExec processing pairs of Documents <span class="s2">&quot;Exec1&quot;</span> and <span class="s2">&quot;Exec2&quot;</span>
Resulting documents Document merging from <span class="s2">&quot;Exec1&quot;</span> and <span class="s2">&quot;Exec2&quot;</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="visualize">
<h2>Visualize<a class="headerlink" href="#visualize" title="Permalink to this heading">#</a></h2>
<p>A <code class="xref py py-class docutils literal notranslate"><span class="pre">Flow</span></code> has a built-in <code class="docutils literal notranslate"><span class="pre">.plot()</span></code> function which can be used to visualize the <code class="docutils literal notranslate"><span class="pre">Flow</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jina</span> <span class="kn">import</span> <span class="n">Flow</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">Flow</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">()</span>
<span class="n">f</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;flow.svg&#39;</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-default">
<a class="reference internal image-reference" href="../../../_images/flow.svg"><img alt="../../../_images/flow.svg" src="../../../_images/flow.svg" width="70%" /></a>
</figure>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jina</span> <span class="kn">import</span> <span class="n">Flow</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">Flow</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;e1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">needs</span><span class="o">=</span><span class="s1">&#39;e1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">needs</span><span class="o">=</span><span class="s1">&#39;e1&#39;</span><span class="p">)</span>
<span class="n">f</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;flow-2.svg&#39;</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-default">
<a class="reference internal image-reference" href="../../../_images/flow-2.svg"><img alt="../../../_images/flow-2.svg" src="../../../_images/flow-2.svg" width="70%" /></a>
</figure>
<p>You can also do it in the terminal:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>jina <span class="nb">export</span> flowchart flow.yml flow.svg 
</pre></div>
</div>
<p>You can also visualize a remote Flow by passing the URL to <code class="docutils literal notranslate"><span class="pre">jina</span> <span class="pre">export</span> <span class="pre">flowchart</span></code>.</p>
</section>
<section id="logging">
<span id="logging-configuration"></span><h2>Logging<a class="headerlink" href="#logging" title="Permalink to this heading">#</a></h2>
<p>The default <code class="xref py py-class docutils literal notranslate"><span class="pre">jina.logging.logger.JinaLogger</span></code> uses rich console logging that writes to the system console. The <code class="docutils literal notranslate"><span class="pre">log_config</span></code> argument can be used to pass in a string of the pre-configured logging configuration names in Jina or the absolute YAML file path of the custom logging configuration. For most cases, the default logging configuration sufficiently covers local, Docker and Kubernetes environments.</p>
<p>Custom logging handlers can be configured by following the Python official <a class="reference external" href="https://docs.python.org/3/howto/logging-cookbook.html#logging-cookbook">Logging Cookbook</a> examples. An example custom logging configuration file defined in a YAML file <code class="docutils literal notranslate"><span class="pre">logging.json.yml</span></code> is:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">handlers</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">StreamHandler</span><span class="w"></span>
<span class="nt">level</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">INFO</span><span class="w"></span>
<span class="nt">configs</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">StreamHandler</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;%(asctime)s:{name:&gt;15}@%(process)2d[%(levelname).1s]:%(message)s&#39;</span><span class="w"></span>
<span class="w">    </span><span class="nt">formatter</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">JsonFormatter</span><span class="w"></span>
</pre></div>
</div>
<p>The logging configuration can be used as follows:</p>
<div class="tab-set docutils">
<input checked="True" class="tab-input" id="tab-set--8-input--1" name="tab-set--8" type="radio"><label class="tab-label" for="tab-set--8-input--1">Python</label><div class="tab-content docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jina</span> <span class="kn">import</span> <span class="n">Flow</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">Flow</span><span class="p">(</span><span class="n">log_config</span><span class="o">=</span><span class="s1">&#39;./logging.json.yml&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<input class="tab-input" id="tab-set--8-input--2" name="tab-set--8" type="radio"><label class="tab-label" for="tab-set--8-input--2">YAML</label><div class="tab-content docutils">
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">jtype</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Flow</span><span class="w"></span>
<span class="nt">with</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="nt">log_config</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;./logging.json.yml&#39;</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<section id="custom-logging-configuration">
<span id="logging-override"></span><h3>Custom logging configuration<a class="headerlink" href="#custom-logging-configuration" title="Permalink to this heading">#</a></h3>
<p>The default <a class="reference internal" href="#logging-configuration"><span class="std std-ref">logging</span></a> or custom logging configuration at the Flow level will be propagated to the <code class="docutils literal notranslate"><span class="pre">Gateway</span></code> and <code class="docutils literal notranslate"><span class="pre">Executor</span></code> entities. If that is not desired, every <code class="docutils literal notranslate"><span class="pre">Gateway</span></code> or <code class="docutils literal notranslate"><span class="pre">Executor</span></code> entity can be provided with its own custom logging configuration.</p>
<p>You can configure two different <code class="docutils literal notranslate"><span class="pre">Executors</span></code> as in the below example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">jina</span> <span class="kn">import</span> <span class="n">Flow</span>

<span class="n">f</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">Flow</span><span class="p">()</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">log_config</span><span class="o">=</span><span class="s1">&#39;./logging.json.yml&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">log_config</span><span class="o">=</span><span class="s1">&#39;./logging.file.yml&#39;</span><span class="p">)</span>
<span class="p">)</span>  <span class="c1"># Create a Flow with two Executors</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">logging.file.yml</span></code> is another YAML file with a custom <code class="docutils literal notranslate"><span class="pre">FileHandler</span></code> configuration.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>Refer to <a class="reference internal" href="../../gateway/#gateway-logging-configuration"><span class="std std-ref">Gateway logging configuration</span></a> section for configuring the <code class="docutils literal notranslate"><span class="pre">Gateway</span></code> logging.</p>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>When exporting the Flow to Kubernetes, the log_config file path must refer to the absolute local path of each container. The custom logging
file must be included during the containerization process. If the availability of the file is unknown then its best to rely on the default
configuration. This restriction also applies to dockerized <code class="docutils literal notranslate"><span class="pre">Executors</span></code>. When running a dockerized Executor locally, the logging configuration
file can be mounted using <a class="reference internal" href="../../executor/hub/use-hub-executor/#mount-local-volumes"><span class="std std-ref">volumes</span></a>.</p>
</div>
</section>
</section>
<section id="methods">
<h2>Methods<a class="headerlink" href="#methods" title="Permalink to this heading">#</a></h2>
<p>The most important methods of the <code class="docutils literal notranslate"><span class="pre">Flow</span></code> object are the following:</p>
<div class="table-wrapper colwidths-auto docutils container">
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Method</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">add()</span></code></p></td>
<td><p>Adds an Executor to the Flow</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">start()</span></code></p></td>
<td><p>Starts the Flow. This will start all its Executors and check if they are ready to be used.</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">close()</span></code></p></td>
<td><p>Stops and closes the Flow. This will stop and shutdown all its Executors.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">with</span></code> context manager</p></td>
<td><p>Uses the Flow as a context manager. It will automatically start and stop your Flow.</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">plot()</span></code></p></td>
<td><p>Visualizes the Flow. Helpful for building complex pipelines.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">post()</span></code></p></td>
<td><p>Sends requests to the Flow API.</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">block()</span></code></p></td>
<td><p>Blocks execution until the program is terminated. This is useful to keep the Flow alive so it can be used from other places (clients, etc).</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">to_docker_compose_yaml()</span></code></p></td>
<td><p>Generates a Docker-Compose file listing all Executors as services.</p></td>
</tr>
<tr class="row-even"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">to_kubernetes_yaml()</span></code></p></td>
<td><p>Generates Kubernetes configuration files in <code class="docutils literal notranslate"><span class="pre">&lt;output_directory&gt;</span></code>. Based on your local Jina version, Executor Hub may rebuild the Docker image during the YAML generation process. If you do not wish to rebuild the image, set the environment variable <code class="docutils literal notranslate"><span class="pre">JINA_HUB_NO_IMAGE_REBUILD</span></code>.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="xref py py-meth docutils literal notranslate"><span class="pre">is_flow_ready()</span></code></p></td>
<td><p>Check if the Flow is ready to process requests. Returns a boolean indicating the readiness.</p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>

                </article>
            </div>
            <footer>
                
                <div class="related-pages">
                    <a class="next-page" href="../add-executors/">
                        <div class="page-info">
                            <div class="context">
                                <span>Next</span>
                            </div>
                            <div class="title">Add Executors</div>
                        </div>
                        <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
                    </a>
                    <a class="prev-page" href="../deployment/">
                        <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
                        <div class="page-info">
                            <div class="context">
                                <span>Previous</span>
                            </div>
                            
                            <div class="title">Deployment</div>
                            
                        </div>
                    </a>
                </div>
                <div class="bottom-of-page">
                    <div class="left-details">
                        <div class="copyright">
                            Copyright &#169; Jina AI Limited. All rights reserved.
                        </div><div class="last-updated">
                            Last updated on Mar 10, 2023</div>
                    </div>
                    <div class="right-details">
                        <div class="social-btns">
                            <a class='social-btn' href="https://github.com/jina-ai/jina" aria-label="GitHub"
                               target="_blank" rel="noreferrer"> <i class="fab fa-github"></i></a>
                            <a class='social-btn' href="https://slack.jina.ai" aria-label="Slack" target="_blank"
                               rel="noreferrer"> <i class="fab fa-slack"></i></a>
                            <a class='social-btn' href="https://youtube.com/c/jina-ai" aria-label="YouTube"
                               target="_blank" rel="noreferrer"> <i class="fab fa-youtube"></i></a>
                            <a class='social-btn' href="https://twitter.com/JinaAI_" aria-label="Twitter"
                               target="_blank" rel="noreferrer"> <i class="fab fa-twitter"></i></a>
                            <a class='social-btn' href="https://www.linkedin.com/company/jinaai/" aria-label="LinkedIn"
                               target="_blank" rel="noreferrer"> <i class="fab fa-linkedin"></i></a>
                        </div>
                    </div>
                </div>
                
            </footer>
        </div>
        <aside class="toc-drawer">
            
            
            <div class="toc-sticky toc-scroll">
                <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
                </div>
                <div class="toc-tree-container">
                    <div class="toc-tree">
                        <ul>
<li><a class="reference internal" href="#">Flow</a><ul>
<li><a class="reference internal" href="#why-use-a-flow">Why use a Flow?</a></li>
<li><a class="reference internal" href="#create">Create</a></li>
<li><a class="reference internal" href="#minimum-working-example">Minimum working example</a></li>
<li><a class="reference internal" href="#start-and-stop">Start and stop</a></li>
<li><a class="reference internal" href="#serve">Serve</a><ul>
<li><a class="reference internal" href="#serve-forever">Serve forever</a></li>
<li><a class="reference internal" href="#serve-until-an-event">Serve until an event</a></li>
<li><a class="reference internal" href="#serve-on-google-colab">Serve on Google Colab</a></li>
</ul>
</li>
<li><a class="reference internal" href="#export">Export</a><ul>
<li><a class="reference internal" href="#docker-compose">Docker Compose</a></li>
<li><a class="reference internal" href="#kubernetes">Kubernetes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#add-executors">Add Executors</a><ul>
<li><a class="reference internal" href="#how-executors-process-documentarrays-in-a-flow">How Executors process DocumentArrays in a Flow</a></li>
<li><a class="reference internal" href="#define-topologies-over-executors">Define topologies over Executors</a></li>
<li><a class="reference internal" href="#floating-executors">Floating Executors</a></li>
<li><a class="reference internal" href="#add-conditioning">Add Conditioning</a><ul>
<li><a class="reference internal" href="#define-conditions">Define conditions</a></li>
<li><a class="reference internal" href="#filtering-outside-the-flow">Filtering outside the Flow</a></li>
</ul>
</li>
<li><a class="reference internal" href="#merging-upstream-documentarrays">Merging upstream DocumentArrays</a><ul>
<li><a class="reference internal" href="#reducing-multiple-documentarrays-to-one-documentarray">Reducing multiple DocumentArrays to one DocumentArray</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#visualize">Visualize</a></li>
<li><a class="reference internal" href="#logging">Logging</a><ul>
<li><a class="reference internal" href="#custom-logging-configuration">Custom logging configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#methods">Methods</a></li>
</ul>
</li>
</ul>

                    </div>
                </div>
            </div>
            
            
        </aside>
    </div>
</div>
<img referrerpolicy="no-referrer-when-downgrade"
     src="https://static.scarf.sh/a.png?x-pxid=2823e771-0e1e-4320-8fde-48bc48e53262"/><script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/scripts/furo.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/tabs.js"></script>
    <script src="../../../_static/design-tabs.js"></script>
    </body>
</html>